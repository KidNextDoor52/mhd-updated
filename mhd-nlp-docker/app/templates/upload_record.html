{% extends "base.html" %}
{% block title %}Upload Records - MHD{% endblock %}

{% block content %}

{% if request.query_params.get('msg') %}
  <div class="alert success">{{ request.query_params.get('msg') }}</div>
{% endif %}
{% if request.query_params.get('err') %}
  <div class="alert danger">{{ request.query_params.get('err') }}</div>
{% endif %}

<h2>Upload a Document</h2>

<form action="/upload/record" method="POST" enctype="multipart/form-data" class="card">
  <label>File</label>
  <input type="file" name="file" required>

  <label style="display:block; margin-top:10px;">Categories (choose one or more)</label>
  <select name="category" multiple size="3" required>
    <option value="Medical">Medical</option>
    <option value="Equipment">Equipment</option>
    <option value="Performance">Performance</option>
  </select>

  <small class="tagline">Tip: upload a CSV to auto-fill your dashboard sections.</small>
  <button type="submit" class="btn" style="margin-top:10px;">Upload</button>
</form>

<h3 style="margin-top: 24px;">Uploaded Files</h3>

<ul style="list-style:none; padding-left:0;">
  {% for file in uploaded_files %}
    <li class="card" style="padding:12px; margin-bottom:10px;">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
        <div>
          <div style="font-weight:700;">
            {{ file.filename }}
          </div>

          <div style="opacity:0.8; font-size:0.95rem; margin-top:4px;">
            <span><strong>Categories:</strong>
              {% if file.category %}
                {{ file.category | join(", ") }}
              {% else %}
                (none)
              {% endif %}
            </span>
            <span style="margin-left:12px;">
              <strong>Uploaded:</strong> {{ file.upload_date }}
            </span>
          </div>

          {% if file.storage_key %}
            <div style="opacity:0.75; font-size:0.85rem; margin-top:4px;">
              <strong>Stored:</strong> {{ file.storage_backend | default("backend") }}
            </div>
          {% else %}
            <div style="opacity:0.75; font-size:0.85rem; margin-top:4px;">
              <strong>Stored:</strong> local-only (legacy)
            </div>
          {% endif %}
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
          <a class="btn" href="/upload/download/{{ file._id }}" target="_blank" rel="noopener">
            Download
          </a>
        </div>
      </div>
    </li>
  {% else %}
    <li>No files uploaded yet.</li>
  {% endfor %}
</ul>

{% endblock %}
