{% extends "base.html" %}
{% block title %}Welcome - MHD{% endblock %}

{% block content %}
<h2>Welcome to MHD Portal</h2>

<div id="login-section" class="card">
  <h3>Login</h3>
  <form onsubmit="login(event)">
    <label>Username:</label>
    <input name="username" required><br>
    <label>Password:</label>
    <input name="password" type="password" required><br>
    <button type="submit">Login</button>
  </form>
</div>

<div id="logout-section" class="card" style="display:none;">
  <p>You are logged in.</p>
  <button onclick="logout()">Logout</button>
</div>

<script>
  window.onload = () => {
    const token = localStorage.getItem("token");
    if (token) {
      document.getElementById("logout-section").style.display = "block";
      document.getElementById("login-section").style.display = "none";
    }
  };

  async function login(event) {
    event.preventDefault();
    const form = new FormData(event.target);

    const res = await fetch("/auth/token", {
      method: "POST",
      body: new URLSearchParams({
        username: form.get("username"),
        password: form.get("password")
      }),
      headers: { "Content-Type": "application/x-www-form-urlencoded" }
    });

    const data = await res.json();
    if (res.ok && data.access_token) {
      localStorage.setItem("token", data.access_token);
      window.location.href = "/dashboard";
    } else {
      alert("Login failed: " + (data.detail || "Unknown error"));
    }
  }
</script>
{% endblock %}
