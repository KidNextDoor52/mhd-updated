{% extends "base.html" %}
{% block title %}MHD Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container fade-in">
  <div class="hero">
    <h2 class="dashboard-title">
      <img src="/static/img/mhd3.png" alt="MHD" class="dashboard-logo" />
      Modern Health Dashboard
    </h2>
    <p class="tagline">Your health, training, and performance at a glance</p>
</div>

  <div class="dashboard-grid">
    <!-- Documents -->
    <div class="card dashboard-card">
      <h3>üìÑ Documents</h3>
      <p>Total Uploaded: <strong>{{ doc_count }}</strong></p>
      <ul class="scroll-5">
        {% for doc in recent_docs %}
          <li>
            {{ (doc.category|join(", ")) or "‚Äî" }} ‚Äî {{ doc.filename }} ({{ doc.upload_date }})
            <a href="/upload/download/{{ doc._id }}">View</a>
            <a href="/share/new?file_id={{ doc._id }}" style="margin-left:.5rem;">Share</a>
          </li>
        {% else %}
          <li>No documents yet.</li>
        {% endfor %}
      </ul>
      <a class="btn primary" href="/upload">Upload New</a>
      <a class="btn secondary" href="/share/new">Share a Document</a>
    </div>

    <!-- Medical Summary -->
    <div class="card dashboard-card">
      <h3>ü©∫ Medical Summary</h3>
      {% if medical and (medical.name or medical.height_in or medical.weight_lb or medical.cleared is not none or medical.allergies or medical.blood_type or medical.dob) %}
        {% if medical.name %}<p><strong>Name:</strong> {{ medical.name }}</p>{% endif %}
        {% if medical.dob %}<p><strong>DOB:</strong> {{ medical.dob }}</p>{% endif %}
        {% if medical.allergies %}<p><strong>Allergies:</strong> {{ medical.allergies }}</p>{% endif %}
        {% if medical.blood_type %}<p><strong>Blood Type:</strong> {{ medical.blood_type }}</p>{% endif %}
        {% if medical.height_in %}<p><strong>Height:</strong> {{ medical.height_in }} in</p>{% endif %}
        {% if medical.weight_lb %}<p><strong>Weight:</strong> {{ medical.weight_lb }} lb</p>{% endif %}
        {% if medical.cleared is not none %}
          <p><strong>Cleared for play:</strong> {{ 'Yes' if medical.cleared else 'No' }}</p>
        {% endif %}
        {% if medical.injury_history %}<p><strong>Injury History:</strong> {{ medical.injury_history }}</p>{% endif %}
      {% else %}
        <p>No medical profile on file.</p>
      {% endif %}
    </div>

    <!-- Medical Docs -->
    <div class="card dashboard-card">
      <h3>ü©∫ Medical Documents</h3>
      <ul class="scroll-5">
        {% for doc in grouped_docs.medical %}
          <li>{{ doc.filename }} ({{ doc.upload_date }}) <a href="/upload/download/{{ doc._id }}">View</a></li>
        {% else %}
          <li>No medical docs yet.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Performance Docs -->
    <div class="card dashboard-card">
      <h3>üèÉ Performance Documents</h3>
      <ul>
        {% for doc in grouped_docs.performance %}
          <li>{{ doc.filename }} ({{ doc.upload_date }}) <a href="/upload/download/{{ doc._id }}">View</a></li>
        {% else %}
          <li>No performance docs yet.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Equipment Docs -->
    <div class="card dashboard-card">
      <h3>üèà Equipment Documents</h3>
      <ul class="scroll-5">
        {% for doc in grouped_docs.equipment %}
          <li>{{ doc.filename }} ({{ doc.upload_date }}) <a href="/upload/download/{{ doc._id }}">View</a></li>
        {% else %}
          <li>No equipment docs yet.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Equipment Overview -->
    <div class="card dashboard-card">
      <h3>üèà Equipment Overview</h3>
      {% set eq_items = equipment.get('items', []) if equipment else [] %}
      {% if eq_items|length > 0 %}
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Category</th>
                <th>Brand</th>
                <th>Type</th>
                <th>Size</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              {% for it in eq_items %}
              <tr>
                <td>{{ it.category or '‚Äî' }}</td>
                <td>{{ it.brand or '‚Äî' }}</td>
                <td>{{ it.type or '‚Äî' }}</td>
                <td>{{ it.size or '‚Äî' }}</td>
                <td>{{ it.notes or '‚Äî' }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <a class="btn primary" href="/equipment">Manage Equipment</a>
      {% else %}
        <p>No equipment recorded.</p>
        <a class="btn success" href="/equipment/form">Set Up Equipment</a>
      {% endif %}
    </div>

    <!-- Training -->
    <div class="card dashboard-card">
      <h3>ü©∫ Training Room Logs</h3>
      <p>Total Sessions: <strong>{{ training_count }}</strong></p>
      <ul>
        {% for log in training_logs %}
          <li>{{ log.injury }} ‚Äî {{ log.details }}</li>
        {% else %}
          <li>No training records yet.</li>
        {% endfor %}
      </ul>
      <a class="btn primary" href="/training">Go to Training Room</a>
    </div>

    <!-- Weightroom -->
    <div class="card dashboard-card">
      <h3>üèãÔ∏è Weightroom</h3>
      {% if weightroom %}
        <p><strong>Bench:</strong> {{ weightroom.bench or "N/A" }} lbs</p>
        <p><strong>Squat:</strong> {{ weightroom.squat or "N/A" }} lbs</p>
        <p><strong>Vertical:</strong> {{ weightroom.vertical or "N/A" }} in</p>
        <p><strong>40-Yard Dash:</strong> {{ weightroom.forty_dash or "N/A" }}s</p>
      {% else %}
        <p>No stats recorded yet.</p>
      {% endif %}
      <a class="btn primary" href="/weightroom">Update Stats</a>
    </div>

    <!-- Recent Activity -->
    <div class="card dashboard-card wide-card">
      <h3>üïí Recent Activity</h3>
      <ul>
        {% for log in activity %}
          {% set md = log.get('metadata', {}) %}
          <li>
            <strong>{{ (log.action or 'activity')|replace('_',' ')|title }}</strong>
            {% if md.get('filename') %}
              ‚Äî File: {{ md.get('filename') }}
            {% elif md.get('injury') %}
              ‚Äî Injury: {{ md.get('injury') }}
            {% elif md.get('bench') or md.get('squat') or md.get('vertical') or md.get('forty_dash') %}
              ‚Äî Bench: {{ md.get('bench', '‚Äî') }} | Squat: {{ md.get('squat', '‚Äî') }} | Vert: {{ md.get('vertical', '‚Äî') }} | 40yd: {{ md.get('forty_dash', '‚Äî') }}
            {% elif md %}
              ‚Äî {{ md }}
            {% endif %}
            <span class="timestamp">({{ log.get('friendly_time','just now') }})</span>
          </li>
        {% else %}
          <li>No recent activity</li>
        {% endfor %}
      </ul>
    </div>

  </div> <!-- /.dashboard-grid -->
</div> <!-- /.dashboard-container -->
{% endblock %}
