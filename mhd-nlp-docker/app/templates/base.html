<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}MHD{% endblock %}</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script>
      function logout() {
        localStorage.removeItem("token");
        window.location.href = "/";
      }
      function isLoggedIn() {
        return !!localStorage.getItem("token");
      }
    </script>
</head>
<body>
  <header class="main-header">
    <div class="logo-container">
      <img src="/static/img/mhd.png" alt="MHD Logo" class="logo">
      <h1><span>Modern Health Dashboard</span></h1>
    </div>
    <nav>
      <a href="/">Home</a>

      {% if user and user.role in ["trainer", "admin"] %}
        <!-- Trainers: main dashboard goes to trainer view -->
        <a href="/trainer/dashboard">Dashboard</a>
      {% else %}
        <!-- Athletes: main dashboard -->
        <a href="javascript:navToProtected('/dashboard')">Dashboard</a>
      {% endif %}

      <a href="javascript:navToProtected('/equipment/')">Equipment</a>
      <a href="javascript:navToProtected('/weightroom/')">Weightroom</a>
      <a href="javascript:navToProtected('/training/')">Training Room</a>
      <a href="javascript:navToProtected('/upload/')">Upload</a>
      <a href="javascript:navToProtected('/profile')">Profile</a>

      {% if user and user.role in ["trainer", "admin"] %}
        <!-- Optional: keep a second link if you want -->
        <a href="/trainer/dashboard">Trainer Dashboard</a>
      {% endif %}

      <a href="javascript:logout()">Logout</a>
    </nav>
  </header>
  <script>
  async function logout() {
    // pass access token for revocation
    const token = localStorage.getItem("token");
    await fetch("/auth/logout", {
      method: "POST",
      headers: token ? { "Authorization": "Bearer " + token } : {}
    });
    localStorage.removeItem("token");
    // also nukes refresh in cookie (server side)
    window.location.href = "/";
  }

  // Optional: require login for protected links
  function navToProtected(path) {
    const token = localStorage.getItem("token");
    if (!token) {
      window.location.href = "/";
      return;
    }
    window.location.href = path;
  }
</script>


  <main class="content">
    {% block content %}{% endblock %}
  </main>

  <footer class="main-footer">
    <p>&copy; 2025 Modern Health Dashboard. All rights reserved.</p>
  </footer>


   <!-- === Charts & Global Dashboard JS === -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/static/js/mhd_charts.js"></script>
</body>
</html>
